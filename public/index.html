<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link href="css/reset.css" rel="stylesheet" type="text/css" media="all" />
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
    <link href="css/all.css" rel="stylesheet" />
    <title>Sharkam</title>
  </head>
  <body>
    <div class="container">
      <div class="top">
        <span class="info"
          ><i class="fas fa-thermometer-quarter"></i>
          <span id="temperature">10</span>°</span
        >
        <span class="info"
          ><i class="fas fa-tint-slash"></i>
          <i class="fas fa-check-circle" id="leak"></i
          ><!-- <i class="fas fa-times"></i
        > --></span
        >
        <span class="info"
          ><i class="fas fa-arrows-alt-h"></i>
          <span id="cameraX">32</span>°</span
        >
        <span class="info"
          ><i class="fas fa-arrows-alt-v"></i>
          <span id="cameraY">76</span>°</span
        >
      </div>
      <div class="stream-container">
        <img src="images/mock.jpg" class="stream" />
        <div class="navigator">
          <div id="up" class="nav-button">
            <i class="fas fa-chevron-up"></i>
          </div>
          <div class="navigator-x">
            <div id="left" class="nav-button">
              <i class="fas fa-chevron-left"></i>
            </div>
            <div id="right" class="nav-button">
              <i class="fas fa-chevron-right"></i>
            </div>
          </div>
          <div id="down" class="nav-button">
            <i class="fas fa-chevron-down"></i>
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="button" id="light">
          Lampa
        </div>
        <!--<div class="button" id="screenshot">
          Ta bild
        </div>-->
      </div>
    </div>
    <script>
      const updateUI = state => {
        document.getElementById("cameraX").innerHTML = state.cameraX;
        document.getElementById("cameraY").innerHTML = state.cameraY;
        document.getElementById("temperature").innerHTML = state.temperature;
        document.getElementById("light").classList.toggle("active");
        document
          .getElementById("leak")
          .classList.remove(state.leak ? "fa-check-circle" : "fa-times");
        document
          .getElementById("leak")
          .classList.add(state.leak ? "fa-times" : "fa-check-circle");
        if (state.leak) {
          document
            .getElementsByClassName("container")[0]
            .classList.add("danger");
        }
      };

      const bindDomToAction = (id, type, value) => {
        document
          .getElementById(id)
          .addEventListener("click", () =>
            ws.send(JSON.stringify({ type, value }))
          );
      };

      const ws = new WebSocket("ws://localhost:3000");
      ws.onmessage = event => {
        const obj = JSON.parse(event.data);
        updateUI(obj);
      };

      bindDomToAction("up", "cameraY", 1);
      bindDomToAction("down", "cameraY", -1);
      bindDomToAction("right", "cameraX", 1);
      bindDomToAction("left", "cameraX", -1);
      bindDomToAction("light", "light");
    </script>
  </body>
</html>
